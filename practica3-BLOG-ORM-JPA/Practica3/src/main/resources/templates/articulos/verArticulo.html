<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${articulo.titulo}">Ver Artículo</title>
    <link rel="stylesheet" href="/estilos/estilosNavbar.css"/>
    <link rel="stylesheet" href="/estilos/estilosArticulos.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900&display=swap" rel="stylesheet"/>

</head>

<body>

<div th:replace="~{/templates/fragmentos/navbar.html :: navbar}"></div>

<div class="container mt-2">

    <!-- ETIQUETAS -->
    <div class="mb-2">
        <span th:each="e : ${articulo.listaEtiquetas}">
            <span class="badge rounded-pill text-bg-secondary me-2"
                  th:text="${e.etiqueta}">
            </span>
        </span>
    </div>

    <!-- TITULO -->
    <h2 class="display-5 link-body-emphasis mb-1" th:text="${articulo.titulo}"></h2>

    <!-- AUTOR Y FECHA -->
    <p class="blog-post-meta">
        Por <strong th:text="${articulo.autor.nombre}"></strong>
        | <span th:text="${articulo.fecha}"></span>
    </p>

    <hr>

    <!-- CUERPO -->
    <div class="mb-4">
        <p th:text="${articulo.cuerpo}" class="articulo-cuerpo"></p>
    </div>

    <hr>

    <!-- COMENTARIOS -->
    <div class="mb-4">
        <h5>Comentarios</h5>

        <div th:if="${articulo.listaComentarios.isEmpty()}">
            <p class="text-muted">No hay comentarios aún.</p>
        </div>

        <div th:each="c : ${articulo.listaComentarios}"
             class="border rounded p-3 mb-3">

            <div class="d-flex justify-content-between">

                <div>
                    <strong th:text="${c.autor.nombre}"></strong>
                    <p class="mb-0" th:text="${c.comentario}"></p>
                </div>

                <!-- BOTON ELIMINAR -->
                <div th:if="${session.user != null and (session.user.administrator or session.user.autor or session.user.id == c.autor.id)}">
                    <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal"
                            th:data-bs-target="'#deleteModal' + ${c.id}">
                        Eliminar
                    </button>
                </div>

                <!-- Modal Eliminar -->
                <div class="modal fade"
                     th:id="'deleteModal' + ${c.id}"
                     tabindex="-1">

                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header">
                                <h5 class="modal-title">
                                    Confirmar eliminación
                                </h5>
                                <button type="button"
                                        class="btn-close"
                                        data-bs-dismiss="modal">
                                </button>
                            </div>

                            <div class="modal-body">
                                ¿Estás seguro de que deseas eliminar este comentario?
                            </div>

                            <div class="modal-footer">
                                <button type="button"
                                        class="btn btn-secondary"
                                        data-bs-dismiss="modal">
                                    Cancelar
                                </button>

                                <a class="btn btn-danger"
                                   th:href="@{'/articulos/' + ${articulo.id} + '/comentarios/eliminar/' + ${c.id}}">
                                    Eliminar
                                </a>
                            </div>

                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <hr>

    <!-- FORMULARIO AGREGAR COMENTARIO -->
    <div class="mb-4">
        <h5>Agregar Comentario</h5>
        <div th:if="${session.user != null}">
            <form th:action="@{'/articulos/' + ${articulo.id} + '/comentarios/agregar'}" method="post">
                <div class="mb-3">
                    <textarea class="form-control" name="comentario" placeholder="Escribe tu comentario aquí..."
                              required></textarea>
                </div>
                <div class="mt-4">
                    <a class="btn btn-secondary me-3" href="/">Volver</a>
                    <button type="submit" class="btn btn-primary">Comentar</button>
                </div>
            </form>
        </div>
        <div th:if="${session.user == null}" class="alert alert-warning mt-3">
            Debes <a href="/login" class="alert-link">iniciar sesión</a> para comentar.
        </div>
    </div>
</div>

</body>
</html>
