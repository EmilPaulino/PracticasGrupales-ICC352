<div th:fragment="navbar">

  <div class="container">
    <header class="border-bottom lh-1 py-3">
      <div class="row flex-nowrap justify-content-between align-items-center">

        <div class="col-4">
          <a class="blog-header-logo text-body-emphasis text-decoration-none" href="/">
            Mi Blog
          </a>
        </div>

        <div class="col-4 d-flex justify-content-end align-items-center">

          <!-- NO logueado -->
          <a th:if="${user == null}"
             class="btn btn-sm btn-outline-secondary"
             th:href="@{/login}">
            Iniciar Sesión
          </a>

          <!-- LOGUEADO -->
          <div th:if="${user != null}" class="dropdown">

            <button class="nav-link dropdown-toggle d-flex align-items-center gap-2"
                    type="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false">

              <img th:src="${user.fotoBase64 != null and !#strings.isEmpty(user.fotoBase64)}
                 ? 'data:image/png;base64,' + ${user.fotoBase64}
                 : '/img/user-default.jpg'"
                   width="32"
                   height="32"
                   class="rounded-circle border"
                   style="object-fit: cover;"/>

              <span th:text="${user.nombre}">Usuario</span>
            </button>

            <ul class="dropdown-menu dropdown-menu-end">

              <li>
                <a class="dropdown-item" href="/">
                  Inicio
                </a>
              </li>

              <!-- Solo admin -->
              <li th:if="${user.administrator}">
                <a class="dropdown-item" th:href="@{/usuarios}">
                  Gestionar Usuarios
                </a>
              </li>

              <!-- Admin o autor -->
              <li th:if="${user.administrator or user.autor}">
                <a class="dropdown-item" th:href="@{/articulos}">
                  Gestionar Artículos
                </a>
              </li>

              <li>
                <a class="dropdown-item" th:href="@{/logout}">
                  Cerrar Sesión
                </a>
              </li>

            </ul>
          </div>

        </div>
      </div>
    </header>
  </div>

</div>